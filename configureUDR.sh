
resourceGroup=$1
routeName=$2

if [ -z $resourceGroup ] || [ -z $routeName ]; then
    echo "Usage: bash configureUDR.sh <resourcegroup> <routename>"
    exit 1
fi

msftips=(
    104.40.0.0/13
    13.104.0.0/14
    40.64.0.0/10
    168.62.0.0/15
    52.160.0.0/11
    102.133.0.0/16
    102.37.0.0/16
    104.208.0.0/13
    111.221.64.0/18
    13.64.0.0/11
    131.253.21.0/24
    131.253.3.0/24
    131.253.32.0/20
    137.116.0.0/15
    137.135.0.0/16
    138.91.0.0/16
    150.171.0.0/16
    157.54.0.0/15
    157.56.0.0/14
    168.61.0.0/16
    191.232.0.0/13
    20.0.0.0/11
    20.150.0.0/15
    20.157.0.0/16
    20.184.0.0/13
    20.192.0.0/10
    20.36.0.0/14
    20.40.0.0/13
    20.48.0.0/12
    20.64.0.0/10
    202.89.224.0/20
    204.79.196.0/23
    207.46.0.0/16
    23.96.0.0/13
    51.10.0.0/15
    51.103.0.0/16
    51.104.0.0/15
    51.107.0.0/16
    51.116.0.0/16
    51.12.0.0/15
    51.120.0.0/16
    51.132.0.0/16
    51.136.0.0/15
    51.138.0.0/16
    51.140.0.0/14
    51.144.0.0/15
    52.136.0.0/13
    52.146.0.0/15
    52.148.0.0/14
    52.152.0.0/13
    52.224.0.0/11
    65.52.0.0/14
    )

rule=1
for ip in "${msftips[@]}"; do
  az network route-table route create -g $resourceGroup --route-table-name $routeName --next-hop-type Internet -n "msft${rule}" --address-prefix $ip
  rule=$((rule+1))
done

